{% extends "base.html" %}

{% block title %}Logistics Dashboard | Jodise{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 flex">
    <!-- Sidebar -->
    <aside class="w-64 bg-white border-r border-gray-200 hidden md:flex flex-col">
        <div class="p-6 border-b border-gray-100">
            <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                ðŸš› Logistics
            </h2>
            <div class="mt-4 flex items-center gap-3">
                <div
                    class="w-10 h-10 rounded-full bg-amber-100 flex items-center justify-center text-amber-600 font-bold">
                    {{ partner.user.first_name|slice:":1" }}
                </div>
                <div>
                    <p class="text-sm font-medium text-gray-900">{{ partner.user.get_full_name }}</p>
                    <span
                        class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium {% if partner.is_verified %}bg-green-100 text-green-800{% else %}bg-yellow-100 text-yellow-800{% endif %}">
                        {% if partner.is_verified %}Verified{% else %}Pending{% endif %}
                    </span>
                </div>
            </div>
        </div>

        <nav class="flex-1 p-4 space-y-1">
            <a href="{% url 'delivery_dashboard' %}"
                class="flex items-center px-4 py-3 bg-amber-50 text-amber-700 rounded-xl font-medium">
                <span class="mr-3">ðŸ“Š</span> Dashboard
            </a>
            <a href="{% url 'available_orders' %}"
                class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-xl transition">
                <span class="mr-3">ðŸ“¦</span> Available Orders
            </a>
        </nav>
    </aside>

    <!-- Content -->
    <main class="flex-1 p-4 md:p-8 overflow-y-auto">
        <div class="max-w-5xl mx-auto">
            <!-- Mobile Header -->
            <div class="md:hidden mb-6 flex items-center justify-between">
                <h1 class="text-2xl font-bold text-gray-900">Dashboard</h1>
                <a href="{% url 'available_orders' %}" class="text-sm font-medium text-amber-600">Find Orders &rarr;</a>
            </div>

            <!-- Stats -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <p class="text-sm text-gray-500 mb-1">Active Deliveries</p>
                    <p class="text-3xl font-bold text-blue-600">{{ active_orders.count }}</p>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <p class="text-sm text-gray-500 mb-1">Completed</p>
                    <p class="text-3xl font-bold text-green-600">{{ completed_count }}</p>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <p class="text-sm text-gray-500 mb-1">Status</p>
                    <p
                        class="text-lg font-bold {% if partner.is_available %}text-green-500{% else %}text-red-500{% endif %}">
                        {% if partner.is_available %}ðŸŸ¢ Online{% else %}ðŸ”´ Offline{% endif %}
                    </p>
                </div>
            </div>

            <h2 class="text-xl font-bold text-gray-900 mb-4">Active Deliveries</h2>

            {% if active_orders %}
            <div class="space-y-4">
                {% for order in active_orders %}
                <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
                    <div
                        class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4 pb-4 border-b border-gray-100">
                        <div>
                            <span class="text-xs font-mono text-gray-400">#{{ order.order_code }}</span>
                            <h3 class="text-lg font-bold text-gray-800">
                                {{ order.delivery_address }}
                            </h3>
                            <p class="text-sm text-gray-500">{{ order.contact_phone }} â€¢ {{ order.buyer.get_full_name }}
                            </p>
                        </div>
                        <div class="text-right">
                            <span class="px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide
                                    {% if order.status == 'in_transit' %}bg-blue-100 text-blue-700
                                    {% elif order.status == 'assigned' %}bg-yellow-100 text-yellow-700
                                    {% else %}bg-gray-100 text-gray-700{% endif %}">
                                {{ order.get_status_display }}
                            </span>
                        </div>
                    </div>

                    <!-- Update Status Form -->
                    <form method="POST" action="{% url 'update_delivery_status' order.pk %}"
                        class="bg-gray-50 p-4 rounded-xl">
                        {% csrf_token %}
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Update Status</label>
                        <div class="flex gap-2">
                            <select name="status"
                                class="flex-1 rounded-lg border-gray-300 text-sm focus:ring-amber-500 focus:border-amber-500">
                                <option value="in_transit" {% if order.status=='in_transit' %}selected{% endif %}>In
                                    Transit</option>
                                <option value="delivered" {% if order.status=='delivered' %}selected{% endif %}>
                                    Delivered</option>
                                <option value="failed">Failed Attempt</option>
                            </select>
                            <button type="submit"
                                class="px-4 py-2 bg-gray-900 text-white text-sm font-bold rounded-lg hover:bg-black transition">
                                Update
                            </button>
                        </div>
                        <input type="text" name="note" placeholder="Optional note (e.g. Left at front desk)"
                            class="mt-2 w-full rounded-lg border-gray-300 text-sm focus:ring-amber-500">
                    </form>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-12 bg-white rounded-2xl border border-dashed border-gray-300">
                <div class="text-4xl mb-3">ðŸ˜´</div>
                <h3 class="text-lg font-medium text-gray-900">No active deliveries</h3>
                <p class="text-gray-500">Check for available orders to start earning.</p>
                <a href="{% url 'available_orders' %}"
                    class="inline-block mt-4 px-6 py-2 bg-amber-500 text-white rounded-lg font-bold hover:bg-amber-600 transition">
                    Find Orders
                </a>
            </div>
            {% endif %}
        </div>
    </main>
</div>
{% endblock %}